if (self.CavalryLogger) { CavalryLogger.start_js(["ZOyoV"]); }

__d('Poller',['ArbiterMixin','AsyncRequest','CurrentUser','emptyFunction','mixin','setTimeoutAcrossTransitions','setTimeout'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this._config=babelHelpers['extends']({clearOnQuicklingEvents:true,setupRequest:c('emptyFunction'),maxRequests:Infinity},l);this._handle=null;this._isSkipIndefinitely=false;this._hasSkippedRequest=false;this._requests=0;this._muted=false;this._polling=false;this._skip=false;this._cancelRequest=c('emptyFunction');if(!this._config.dontStart)this.start();}j.prototype.start=function(){'use strict';if(this._polling)return this;this._requests=0;this.request();return this};j.prototype.stop=function(){'use strict';this._cancelRequest();return this};j.prototype.mute=function(){'use strict';this._muted=true;return this};j.prototype.resume=function(){'use strict';if(this._muted){this._muted=false;if(this._handle===null&&this._polling)return this.request();}if(this._isSkipIndefinitely){this._isSkipIndefinitely=false;return this.request()}return this};j.prototype.skip=function(){'use strict';this._skip=true;return this};j.prototype.startSkipIndefinitely=function(){'use strict';this._isSkipIndefinitely=true;return this};j.prototype.stopSkipIndefinitely=function(){'use strict';this._isSkipIndefinitely=false;if(this._hasSkippedRequest){return this.request()}else return this;};j.prototype.isSkipIndefinitely=function(){'use strict';return this._isSkipIndefinitely};j.prototype.reset=function(){'use strict';return this.stop().start()};j.prototype.request=function(){'use strict';this._cancelRequest();this._polling=true;if(!this._config.allowNotLoggedIn&&!k())return this._done();if(this._muted)return this;var l=false;this._cancelRequest=function(){l=true;this._cleanup()}.bind(this);if(this._isSkipIndefinitely){this._deferRequest();this._hasSkippedRequest=true;return this}else this._hasSkippedRequest=false;if(++this._requests>this._config.maxRequests)return this._done();var m=new (c('AsyncRequest'))();m.setIsBackgroundRequest(true);m.setInitialHandler(function(){return !l});m.setFinallyHandler(this._deferRequest.bind(this));{m.setInitialHandler=c('emptyFunction');m.setFinallyHandler=c('emptyFunction')}this._config.setupRequest(m,this);if(this._skip){this._skip=false;c('setTimeoutAcrossTransitions')(this._deferRequest.bind(this),0)}else m.send();return this};j.prototype.isPolling=function(){'use strict';return this._polling};j.prototype.isMuted=function(){'use strict';return this._muted};j.prototype.setInterval=function(l){'use strict';if(l){this._config.interval=l;this.start()}};j.prototype.getInterval=function(){'use strict';return this._config.interval};j.prototype._cleanup=function(){'use strict';if(this._handle!==null)clearTimeout(this._handle);this._handle=null;this._cancelRequest=c('emptyFunction');this._polling=false};j.prototype._done=function(){'use strict';this._cleanup();this.inform('done',{sender:this});return this};j.prototype._deferRequest=function(){'use strict';if(!this._polling)return;if(this._requests<this._config.maxRequests){var l=this._config.interval;l=typeof l==='function'?l(this._requests):l;l=l>j.MIN_INTERVAL?l:j.MIN_INTERVAL;if(this._config.clearOnQuicklingEvents){this._handle=c('setTimeout')(this.request.bind(this),l)}else this._handle=c('setTimeoutAcrossTransitions')(this.request.bind(this),l);}else this._done();};j.MIN_INTERVAL=2000;function k(){return c('CurrentUser').isLoggedInNow()}f.exports=j}),null);
__d('ChatImpressionLogger',['AsyncSignal','ChatConfig','ChatVisibility','Poller','PresencePrivacy','PresenceStatus','requireWeak','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){var h=null;c('requireWeak')('AvailableList',function(m){return h=m});var i=null;function j(m){if(!i){m([])}else i.getSortedList(function(n){return m(n)});}function k(m){if(!i||!h)return '';var n=[];for(var o=0;o<m.length;o++)n[o]=h.get(m[o]);return n.toString()}var l={init:function m(n){i=n;j(function(o){var p,q=o.toString(),r=k(o),s=c('ChatConfig').get('chat_impression_logging_periodical',0);if(s)(function(){var t=c('ChatConfig').get('periodical_impression_logging_config.interval'),u=new (c('Poller'))({interval:t,setupRequest:function v(w){w.setURI('/ajax/chat/imps_logging.php').setData({list_availability:r,sorted_list:q,source:'periodical_imps'})},clearOnQuicklingEvents:false,dontStart:true});c('PresencePrivacy').subscribe('privacy-user-presence-changed',c('debounceAcrossTransitions')(function(){if(c('ChatVisibility').isOnline()){u.start()}else u.stop();}))})();});this.init=function(){}},logImpression:function m(n,o,p){j(function(q){var r=c('ChatConfig').get('chat_impression_logging_with_click'),s={list_availability:r?k(q):'',sorted_list:r?q.toString():'',source:n,target:o,target_presence:c('PresenceStatus').get(o),viewport_width:document.body.clientWidth};new (c('AsyncSignal'))('/ajax/chat/ct.php',Object.assign(s,p)).send()})}};f.exports=l}),null);